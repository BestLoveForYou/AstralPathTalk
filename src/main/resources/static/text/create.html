<html>
	<head>
		<meta charset="utf-8">
		<script src="/webjars/jquery/jquery.js"></script>
		<link href="/css/index.css" rel="stylesheet" type="text/css" />
		<link href="/css/text.css" rel="stylesheet" type="text/css" />
		<link href="/css/tanchuang.css" rel="stylesheet" type="text/css" />
		<title>AstralPath - 星途</title>
		<script src="/js/tanchuang.js"></script>
		<script src="/webjars/jquery/jquery.min.js"></script>
    	<script src="/webjars/sockjs-client/sockjs.min.js"></script>
    	<script src="/webjars/stomp-websocket/stomp.min.js"></script>
		<script>
	    function createXMLHTTPObject(){
	        var XMLHttpFactories = [// 兼容不同浏览器和版本的创建函数数组
	            function () {return new XMLHttpRequest()},
	            function () {return new ActiveXObject("Msxml2.XMLHTTP")},
	            function () {return new ActiveXObject("Msxml3.XMLHTTP")},
	            function () {return new ActiveXObject("Microsoft.XMLHTTP")},
	        ];
	        var xmlhttp = false;
	        for (var i = 0; i < XMLHttpFactories.length; i ++ ){ 
	    	//尝试调用匿名函数，如果成功则返回XMLHttpRequest对象，否则继续调用下一个
	            try{
	                xmlhttp = XMLHttpFactories[i]();
	            }catch (e){
	                continue; 			// 如果发生异常，则继续下一个函数调用
	            }
	            break; 					// 如果成功，则中止循环
	        }
	        return xmlhttp; 				// 返回对象实例
	    }

		function cr() {
			
			var x=  document.getElementById("text1").value//获取输入框元素
			var y=  document.getElementById("title").value//获取输入框元素
	    	url = "create?title=" + y + "&target=测试&body=" + x; 
			url = url.replace(/\n/gi,"<br>");//保留换行符
	    	xmlHttp.open("POST",url, false);
	    	xmlHttp.setRequestHeader('Content-type','application/x-www-form-urlencoded');	
	    	xmlHttp.send("callback=functionName");
	    	obj = JSON.parse(xmlHttp.responseText);
			alert("文章创建成功!");
			window.location.href="/text/index.html";
		}
		</script>
	</head>
	<body>
		
		<header class="f">AstralPath - 星途
		</header>
		<section>
    	<article>
    	<div>
    		<script>
    		var xmlHttp = createXMLHTTPObject();
	    	var url = "getUserLogin"; 
	    	xmlHttp.open("POST",url, false);
	    	xmlHttp.setRequestHeader('Content-type','application/x-www-form-urlencoded');	
	    	xmlHttp.send("callback=functionName");
	    	var obj = JSON.parse(xmlHttp.responseText);
	    	//1.设置内容。
	    	
	    	if(obj.username == undefined) {
	    		window.location.href="/user/index.html";
	    	} else {
			}
    		</script>
    		<input type="text" class="t1" id="title" placeholder="标题">
    		<textarea cols="25" rows="5" class="textc" id="text1" placeholder="说点什么吧"></textarea>
			<iframe id="iframe" name="iframe" style="display:none;"></iframe>
			
			<button id="create" type="button" onclick="cr()">发表</button>
			</div>
    	 </article>
		<nav>
			<p>AstralPath编辑器Beta</p>
			<br>
			<a href="/text/index.html">退回文章页面</a>
		</nav>
   		<aside>
			
		</aside>
		</section>
		<footer>
			<p>鄂ICP备2021014649号</p>
		</footer>

	</body>

</html>
